/*
 * The MIT License
 *
 * (MIT)Copyright (c) 2015 artjomb
 */
!function(t,i){"function"==typeof define&&define.amd?define(["crypto-js/core","crypto-js/aes","crypto-js/mode-ctr"],i):i(t.CryptoJS)}(this,function(r){(s=r.hasOwnProperty("ext")?r.ext:r.ext={}).bitshift=function(t,i){var n,e=0,r=t.words,s=0;if(0<i){for(;31<i;)r.splice(0,1),r.push(0),i-=32,s++;if(0==i)return e;for(var o=r.length-s-1;0<=o;o--)n=r[o],r[o]<<=i,r[o]|=e,e=n>>>32-i}else if(i<0){for(;i<-31;)r.splice(0,0,0),r.length--,i+=32,s++;if(0==i)return e;for(var a=(1<<(i=-i))-1,o=s;o<r.length;o++)n=r[o]&a,r[o]>>>=i,r[o]|=e,e=n<<32-i}return e},s.neg=function(t){for(var i=t.words,n=0;n<i.length;n++)i[n]=~i[n];return t},s.xor=function(t,i){for(var n=0;n<t.words.length;n++)t.words[n]^=i.words[n];return t},s.bitand=function(t,i){for(var t=t.clone(),n=t.words,e=i.words,r=0;r<n.length;r++)n[r]&=e[r];return t},s=r.hasOwnProperty("ext")?r.ext:r.ext={};var t=r.lib.Base,o=r.lib.WordArray,t=(s.const_Zero=new o.init([0,0,0,0]),s.const_One=new o.init([0,0,0,1]),s.const_Rb=new o.init([0,0,0,135]),s.const_Rb_Shifted=new o.init([2147483648,0,0,67]),s.const_nonMSB=new o.init([4294967295,4294967295,2147483647,2147483647]),s.isWordArray=function(t){return t&&"function"==typeof t.clamp&&"function"==typeof t.concat&&"array"==typeof t.words},r.pad.OneZeroPadding={pad:function(t,i){for(var i=4*i,n=i-t.sigBytes%i,e=[],r=0;r<n;r+=4){var s=0===r?2147483648:0;e.push(s)}i=new o.init(e,n);t.concat(i)},unpad:function(){}},r.pad.NoPadding={pad:function(){},unpad:function(){}},s.leftmostBytes=function(t,i){t=t.clone();return t.sigBytes=i,t.clamp(),t},s.rightmostBytes=function(t,i){t.clamp();var n,t=t.clone(),i=8*(t.sigBytes-i);return 32<=i&&(i-=32*(n=Math.floor(i/32)),t.words.splice(0,n),t.sigBytes-=32*n/8),0<i&&(s.bitshift(t,i),t.sigBytes-=i/8),t},s.popWords=function(t,i){var n=t.words.splice(0,i);return t.sigBytes-=4*i,new o.init(n)},s.shiftBytes=function(t,i){for(var n=(i=i||16)%4,e=(i-=n,new o.init),r=0;r<i;r+=4)e.words.push(t.words.shift()),t.sigBytes-=4,e.sigBytes+=4;return 0<n&&(e.words.push(t.words[0]),e.sigBytes+=n,s.bitshift(t,8*n),t.sigBytes-=n),e},s.xorendBytes=function(t,i){return s.leftmostBytes(t,t.sigBytes-i.sigBytes).concat(s.xor(s.rightmostBytes(t,i.sigBytes),i))},s.dbl=function(t){var i=s.msb(t);return s.bitshift(t,1),s.xor(t,1===i?s.const_Rb:s.const_Zero),t},s.inv=function(t){var i=1&t.words[4];return s.bitshift(t,-1),s.xor(t,1==i?s.const_Rb_Shifted:s.const_Zero),t},s.equals=function(t,i){if(!i||!i.words||t.sigBytes!==i.sigBytes)return!1;t.clamp(),i.clamp();for(var n=0,e=0;e<t.words.length;e++)n|=t.words[e]^i.words[e];return 0===n},s.msb=function(t){return t.words[0]>>>31},r.lib.Base),o=r.lib.WordArray,e=r.algo.AES,s=r.ext,a=r.pad.OneZeroPadding,c=r.algo.CMAC=t.extend({init:function(t){this._aes=e.createEncryptor(t,{iv:new o.init,padding:r.pad.NoPadding});var i,t=this._aes.finalize(s.const_Zero),n=t.clone();s.dbl(n),this._isTwo?(i=t.clone(),s.inv(i)):(i=n.clone(),s.dbl(i)),this._K1=n,this._K2=i,this._const_Bsize=16,this.reset()},reset:function(){this._x=s.const_Zero.clone(),this._counter=0,this._buffer=new o.init},update:function(t){if(t){var i=this._buffer,n=this._const_Bsize;for("string"==typeof t&&(t=r.enc.Utf8.parse(t)),i.concat(t);i.sigBytes>n;){var e=s.shiftBytes(i,n);s.xor(this._x,e),this._x.clamp(),this._aes.reset(),this._x=this._aes.finalize(this._x),this._counter++}}return this},finalize:function(t){this.update(t);var t=this._buffer,i=this._const_Bsize,n=t.clone();return t.sigBytes===i?s.xor(n,this._K1):(a.pad(n,i/4),s.xor(n,this._K2)),s.xor(n,this._x),this.reset(),this._aes.reset(),this._aes.finalize(n)},_isTwo:!1}),t=(r.CMAC=function(t,i){return c.create(t).finalize(i)},r.algo.OMAC1=c,r.algo.OMAC2=c.extend({_isTwo:!0}),r.lib.Base),o=r.lib.WordArray,e=r.algo.AES,s=r.ext,c=r.algo.CMAC,f=new o.init([0,0,0,0]),i=new o.init([0,0,0,1]),u=new o.init([0,0,0,2]);r.EAX=t.extend({init:function(t,i){var n;n=i&&i.splitKey?(n=Math.floor(t.sigBytes/2),s.shiftBytes(t,n)):t.clone(),this._ctrKey=t,this._mac=c.create(n),this._tagLen=i&&i.tagLength||16,this.reset()},reset:function(){this._mac.update(i),this._ctr&&this._ctr.reset()},updateAAD:function(t){return this._mac.update(t),this},initCrypt:function(t,i){var n=this;return n._tag=n._mac.finalize(),n._isEnc=t,n._mac.update(f),i=n._mac.finalize(i),s.xor(n._tag,i),n._ctr=e.createEncryptor(n._ctrKey,{iv:i,mode:r.mode.CTR,padding:r.pad.NoPadding}),n._buf=new o.init,n._mac.update(u),n},update:function(t){"string"==typeof t&&(t=r.enc.Utf8.parse(t));var i=this,n=i._buf,e=i._isEnc,t=(n.concat(t),e?n.sigBytes:Math.max(n.sigBytes-i._tagLen,0)),n=0<t?s.shiftBytes(n,t):new o.init,t=i._ctr.process(n);return i._mac.update(e?t:n),t},finalize:function(t){var i,n=this,t=t?n.update(t):new o.init,e=n._mac,r=n._ctr.finalize();return n._isEnc?(i=e.finalize(r),s.xor(n._tag,i),n.reset(),t.concat(r).concat(n._tag)):(i=e.finalize(),s.xor(n._tag,i),n.reset(),!!s.equals(n._tag,n._buf)&&t.concat(r))},encrypt:function(t,i,n){var e=this;return n&&Array.prototype.forEach.call(n,function(t){e.updateAAD(t)}),e.initCrypt(!0,i),e.finalize(t)},decrypt:function(t,i,n){var e=this;return n&&Array.prototype.forEach.call(n,function(t){e.updateAAD(t)}),e.initCrypt(!1,i),e.finalize(t)}})});