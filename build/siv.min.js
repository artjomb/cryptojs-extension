/*
 * The MIT License
 *
 * (MIT)Copyright (c) 2015 artjomb
 */
!function(t,e){"function"==typeof define&&define.amd?define(["crypto-js/core","crypto-js/aes","crypto-js/mode-ctr"],e):e(t.CryptoJS)}(this,function(o){(c=o.hasOwnProperty("ext")?o.ext:o.ext={}).bitshift=function(t,e){var i,n=0,s=t.words,r=0;if(0<e){for(;31<e;)s.splice(0,1),s.push(0),e-=32,r++;if(0==e)return n;for(var o=s.length-r-1;0<=o;o--)i=s[o],s[o]<<=e,s[o]|=n,n=i>>>32-e}else if(e<0){for(;e<-31;)s.splice(0,0,0),s.length--,e+=32,r++;if(0==e)return n;for(var a=(1<<(e=-e))-1,o=r;o<s.length;o++)i=s[o]&a,s[o]>>>=e,s[o]|=n,n=i<<32-e}return n},c.neg=function(t){for(var e=t.words,i=0;i<e.length;i++)e[i]=~e[i];return t},c.xor=function(t,e){for(var i=0;i<t.words.length;i++)t.words[i]^=e.words[i];return t},c.bitand=function(t,e){for(var t=t.clone(),i=t.words,n=e.words,s=0;s<i.length;s++)i[s]&=n[s];return t},c=o.hasOwnProperty("ext")?o.ext:o.ext={};var t=o.lib.Base,a=o.lib.WordArray,t=(c.const_Zero=new a.init([0,0,0,0]),c.const_One=new a.init([0,0,0,1]),c.const_Rb=new a.init([0,0,0,135]),c.const_Rb_Shifted=new a.init([2147483648,0,0,67]),c.const_nonMSB=new a.init([4294967295,4294967295,2147483647,2147483647]),c.isWordArray=function(t){return t&&"function"==typeof t.clamp&&"function"==typeof t.concat&&"array"==typeof t.words},o.pad.OneZeroPadding={pad:function(t,e){for(var e=4*e,i=e-t.sigBytes%e,n=[],s=0;s<i;s+=4){var r=0===s?2147483648:0;n.push(r)}e=new a.init(n,i);t.concat(e)},unpad:function(){}},o.pad.NoPadding={pad:function(){},unpad:function(){}},c.leftmostBytes=function(t,e){t=t.clone();return t.sigBytes=e,t.clamp(),t},c.rightmostBytes=function(t,e){t.clamp();var i,t=t.clone(),e=8*(t.sigBytes-e);return 32<=e&&(e-=32*(i=Math.floor(e/32)),t.words.splice(0,i),t.sigBytes-=32*i/8),0<e&&(c.bitshift(t,e),t.sigBytes-=e/8),t},c.popWords=function(t,e){var i=t.words.splice(0,e);return t.sigBytes-=4*e,new a.init(i)},c.shiftBytes=function(t,e){for(var i=(e=e||16)%4,n=(e-=i,new a.init),s=0;s<e;s+=4)n.words.push(t.words.shift()),t.sigBytes-=4,n.sigBytes+=4;return 0<i&&(n.words.push(t.words[0]),n.sigBytes+=i,c.bitshift(t,8*i),t.sigBytes-=i),n},c.xorendBytes=function(t,e){return c.leftmostBytes(t,t.sigBytes-e.sigBytes).concat(c.xor(c.rightmostBytes(t,e.sigBytes),e))},c.dbl=function(t){var e=c.msb(t);return c.bitshift(t,1),c.xor(t,1===e?c.const_Rb:c.const_Zero),t},c.inv=function(t){var e=1&t.words[4];return c.bitshift(t,-1),c.xor(t,1==e?c.const_Rb_Shifted:c.const_Zero),t},c.equals=function(t,e){if(!e||!e.words||t.sigBytes!==e.sigBytes)return!1;t.clamp(),e.clamp();for(var i=0,n=0;n<t.words.length;n++)i|=t.words[n]^e.words[n];return 0===i},c.msb=function(t){return t.words[0]>>>31},o.lib.Base),a=o.lib.WordArray,n=o.algo.AES,c=o.ext,s=o.pad.OneZeroPadding,i=o.algo.CMAC=t.extend({init:function(t){this._aes=n.createEncryptor(t,{iv:new a.init,padding:o.pad.NoPadding});var e,t=this._aes.finalize(c.const_Zero),i=t.clone();c.dbl(i),this._isTwo?(e=t.clone(),c.inv(e)):(e=i.clone(),c.dbl(e)),this._K1=i,this._K2=e,this._const_Bsize=16,this.reset()},reset:function(){this._x=c.const_Zero.clone(),this._counter=0,this._buffer=new a.init},update:function(t){if(t){var e=this._buffer,i=this._const_Bsize;for("string"==typeof t&&(t=o.enc.Utf8.parse(t)),e.concat(t);e.sigBytes>i;){var n=c.shiftBytes(e,i);c.xor(this._x,n),this._x.clamp(),this._aes.reset(),this._x=this._aes.finalize(this._x),this._counter++}}return this},finalize:function(t){this.update(t);var t=this._buffer,e=this._const_Bsize,i=t.clone();return t.sigBytes===e?c.xor(i,this._K1):(s.pad(i,e/4),c.xor(i,this._K2)),c.xor(i,this._x),this.reset(),this._aes.reset(),this._aes.finalize(i)},_isTwo:!1}),t=(o.CMAC=function(t,e){return i.create(t).finalize(e)},o.algo.OMAC1=i,o.algo.OMAC2=i.extend({_isTwo:!0}),o.lib.Base),a=o.lib.WordArray,n=o.algo.AES,c=o.ext,s=o.pad.OneZeroPadding,i=o.algo.CMAC,r=o.algo.S2V=t.extend({init:function(t){this._blockSize=16,this._cmacAD=i.create(t),this._cmacPT=i.create(t),this.reset()},reset:function(){this._buffer=new a.init,this._cmacAD.reset(),this._cmacPT.reset(),this._d=this._cmacAD.finalize(c.const_Zero),this._empty=!0,this._ptStarted=!1},updateAAD:function(t){return this._ptStarted||t&&("string"==typeof t&&(t=o.enc.Utf8.parse(t)),this._d=c.xor(c.dbl(this._d),this._cmacAD.finalize(t)),this._empty=!1),this},update:function(t){if(t){this._ptStarted=!0;var e=this._buffer,i=this._blockSize,n=i/4,s=this._cmacPT;for("string"==typeof t&&(t=o.enc.Utf8.parse(t)),e.concat(t);e.sigBytes>=2*i;){this._empty=!1;var r=c.popWords(e,n);s.update(r)}}return this},finalize:function(t){this.update(t);var t=this._blockSize,e=this._buffer;return this._empty&&0===e.sigBytes?this._cmacAD.finalize(c.const_One):(t=e.sigBytes>=t?c.xorendBytes(e,this._d):(s.pad(e,t),c.xor(c.dbl(this._d),e)),this._cmacPT.finalize(t))}});o.SIV=t.extend({init:function(t){var e=t.sigBytes/2;this._s2vKey=c.shiftBytes(t,e),this._ctrKey=t},encrypt:function(t,e){!e&&t&&(e=t,t=[]);var i=r.create(this._s2vKey),t=(Array.prototype.forEach.call(t,function(t){i.updateAAD(t)}),i.finalize(e)),n=c.bitand(t,c.const_nonMSB),e=o.AES.encrypt(e,this._ctrKey,{iv:n,mode:o.mode.CTR,padding:o.pad.NoPadding});return t.concat(e.ciphertext)},decrypt:function(t,e){!e&&t&&(e=t,t=[]);var i=c.shiftBytes(e,16),n=c.bitand(i,c.const_nonMSB),e=o.AES.decrypt({ciphertext:e},this._ctrKey,{iv:n,mode:o.mode.CTR,padding:o.pad.NoPadding}),s=r.create(this._s2vKey),n=(Array.prototype.forEach.call(t,function(t){s.updateAAD(t)}),s.finalize(e));return!!c.equals(i,n)&&e}})});